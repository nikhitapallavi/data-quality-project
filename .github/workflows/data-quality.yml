name: üîç Data Quality Checks

on:
  push:
    branches: [main]

jobs:
  data-quality:
    runs-on: ubuntu-latest

    steps:

      - name: üì• Checkout Code
        uses: actions/checkout@v3

      - name: üêç Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: üì¶ Install Dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: üîç Run Data Quality Checks
        run: python run_allchecks.py
        env:
          POSTGRES_CONNECTION:  ${{ secrets.POSTGRES_CONNECTION }}
          MYSQL_CONNECTION:     ${{ secrets.MYSQL_CONNECTION }}
          MONGO_CONNECTION:     ${{ secrets.MONGO_CONNECTION }}
          CLICKHOUSE_HOST:      ${{ secrets.CLICKHOUSE_HOST }}
          CLICKHOUSE_PORT:      8123
          CLICKHOUSE_USER:      default
          CLICKHOUSE_PASSWORD:  ${{ secrets.CLICKHOUSE_PASSWORD }}
          CLICKHOUSE_DB:        data_quality
          DEPLOYMENT_ID:        ${{ github.sha }}
          TRIGGERED_BY:         github_actions
          ENVIRONMENT:          production

      - name: ‚úÖ Success Message
        if: success()
        run: echo "üéâ All data quality checks passed!"

      - name: ‚ùå Failure Message
        if: failure()
        run: echo "üö® Data quality checks failed! Check logs above."
