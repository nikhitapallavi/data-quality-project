name: ğŸ” Data Quality Checks

# â”€â”€ When to run â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  push:
    branches: [main]        # Runs on every push to main

jobs:
  data-quality:
    runs-on: ubuntu-latest  # GitHub provides this machine

    steps:

      # â”€â”€ Step 1: Download your code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v3

      # â”€â”€ Step 2: Install Python â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ Setup Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # â”€â”€ Step 3: Install all pip packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¦ Install Dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      # â”€â”€ Step 4: Run your quality checks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ” Run Data Quality Checks
        run: python run_allchecks.py
        env:
          POSTGRES_CONNECTION:  ${{ secrets.POSTGRES_CONNECTION }}
          MYSQL_CONNECTION:     ${{ secrets.MYSQL_CONNECTION }}
          MONGO_CONNECTION:     ${{ secrets.MONGO_CONNECTION }}
          CLICKHOUSE_HOST:      ${{ secrets.CLICKHOUSE_HOST }}
          CLICKHOUSE_PORT:      8123
          CLICKHOUSE_USER:      default
          CLICKHOUSE_PASSWORD:  ${{ secrets.CLICKHOUSE_PASSWORD }}
          CLICKHOUSE_DB:        data_quality
          DEPLOYMENT_ID:        ${{ github.sha }}
          TRIGGERED_BY:         github_actions
          ENVIRONMENT:          production

      # â”€â”€ Step 5: Show result in GitHub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: âœ… Success Message
        if: success()
        run: echo "ğŸ‰ All data quality checks passed!"

      - name: âŒ Failure Message
        if: failure()
        run: echo "ğŸš¨ Data quality checks failed! Check logs above."
